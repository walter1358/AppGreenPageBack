Ù
_D:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\WeatherForecast.cs
	namespace 	
GreenPageAPI
 
{ 
public 

class 
WeatherForecast  
{ 
public 
DateOnly 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
public 
int 
TemperatureC 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
int		 
TemperatureF		 
=>		  "
$num		# %
+		& '
(		( )
int		) ,
)		, -
(		- .
TemperatureC		. :
/		; <
$num		= C
)		C D
;		D E
public 
string 
? 
Summary 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} ™1
^D:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Models\Usuario.cs
	namespace 	
GreenPageAPI
 
. 
Models 
{ 
[ 
Table 

(
 
$str 
) 
] 
public		 

class		 
Usuario		 
{

 
[ 	
Key	 
] 
public 
int 
? 
	IdUsuario 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int 
? 
IdPerfil 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 

NomUsuario  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 

ApeUsuario  
{" #
get# &
;& '
set' *
;* +
}+ ,
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
dni 
{ 
get 
;  
set  #
;# $
}$ %
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
Login 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Required	 
] 
[   	
StringLength  	 
(   
$num   
)   
]   
public!! 
string!! 
Pass!! 
{!! 
get!!  
;!!  !
set!!" %
;!!% &
}!!' (
[## 	
StringLength##	 
(## 
$num## 
)## 
]## 
public$$ 
string$$ 
?$$ 
Pregunta$$ 
{$$  !
get$$" %
;$$% &
set$$' *
;$$* +
}$$, -
[&& 	
StringLength&&	 
(&& 
$num&& 
)&& 
]&& 
public'' 
string'' 
?'' 
	Respuesta''  
{''! "
get''# &
;''& '
set''( +
;''+ ,
}''- .
public)) 
DateTime)) 
?)) 
FecCreacion)) $
{))% &
get))' *
;))* +
set)), /
;))/ 0
}))1 2
public++ 
bool++ 
?++ 
isactive++ 
{++ 
get++ !
;++! "
set++" %
;++% &
}++& '
public-- 
bool-- 
IsValidPassword-- #
(--# $
)--$ %
{.. 	
return00 
!00 
string00 
.00 
IsNullOrEmpty00 (
(00( )
Pass00) -
)00- .
&&00/ 1
Pass11 
.11 
Length11 
>11  
$num11! "
&&11# %
Pass22 
.22 
Any22 
(22 
char22  
.22  !
IsUpper22! (
)22( )
&&22* ,
Pass33 
.33 
Any33 
(33 
char33  
.33  !
IsLower33! (
)33( )
&&33* ,
Pass44 
.44 
Any44 
(44 
char44  
.44  !
IsDigit44! (
)44( )
;44) *
}55 	
public77 
bool77 
IsValidLength77 !
(77! "
string77" (
username77) 1
)771 2
{88 	
return99 
username99 
.99 
Length99 "
>=99# %
$num99& '
&&99( *
username99+ 3
.993 4
Length994 :
<=99; =
$num99> @
;99@ A
}:: 	
public;; 
bool;; "
IsValidLengthRespuesta;; *
(;;* +
);;+ ,
{<< 	
return== 
	Respuesta== 
.== 
Trim== !
(==! "
)==" #
.==# $
Length==$ *
<===+ -
$num==. 0
;==0 1
}>> 	
public@@ 
bool@@ 
ContainsOnlyLetters@@ '
(@@' (
string@@( .
username@@/ 7
)@@7 8
{AA 	
returnCC 
usernameCC 
.CC 
AllCC 
(CC  
cCC  !
=>CC" $
charCC% )
.CC) *
IsLetterCC* 2
(CC2 3
cCC3 4
)CC4 5
||CC6 8
charCC9 =
.CC= >
IsWhiteSpaceCC> J
(CCJ K
cCCK L
)CCL M
)CCM N
;CCN O
}DD 	
publicFF 
boolFF $
ValidarEspaciosIzquierdaFF -
(FF- .
stringFF. 4
cadenaFF5 ;
)FF; <
{GG 	
stringII 
patternII 
=II  
$strII! C
;IIC D
RegexJJ 
regexJJ 
=JJ 
newJJ !
RegexJJ" '
(JJ' (
patternJJ( /
)JJ/ 0
;JJ0 1
returnLL 
regexLL 
.LL 
IsMatchLL $
(LL$ %
cadenaLL% +
)LL+ ,
;LL, -
}MM 	
publicPP 

boolPP 
IsValidEmailPP 
(PP 
stringPP #
emailPP$ )
)PP) *
{QQ 
stringSS 
patternSS 
=SS 
$strSS 6
;SS6 7
returnTT 
RegexTT 
.TT 
IsMatchTT 
(TT 
emailTT "
,TT" #
patternTT$ +
)TT+ ,
;TT, -
}UU 
}WW 
}XX †(
WD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Program.cs
Env 
. 
Load 
( 	
$str	 
) 
; 
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Configuration 
. 
SetBasePath 
( 
	Directory 
. 
GetCurrentDirectory .
(. /
)/ 0
)0 1
. 
AddJsonFile 
( 
$str #
,# $
optional% -
:- .
false/ 4
,4 5
reloadOnChange6 D
:D E
trueF J
)J K
. #
AddEnvironmentVariables 
( 
) 
; 
builder 
. 
Services 
. 

AddSignalR 
( 
) 
; 
var 

dbPassword 
= 
Environment 
. "
GetEnvironmentVariable 3
(3 4
$str4 A
)A B
;B C
if 
( 
string 

.
 
IsNullOrEmpty 
( 

dbPassword #
)# $
)$ %
{ 
throw 	
new
 %
InvalidOperationException '
(' (
$str( a
)a b
;b c
} 
builder"" 
."" 
Services"" 
."" 
AddDbContext"" 
<"" 
GreenPageContext"" .
>"". /
(""/ 0
options""0 7
=>""8 :
options## 
.## 
UseSqlServer## 
(## 
builder##  
.##  !
Configuration##! .
.##. /
GetConnectionString##/ B
(##B C
$str##C V
)##V W
?##W X
.##X Y
Replace##Y `
(##` a
$str##a p
,##p q

dbPassword##r |
)##| }
)##} ~
)$$ 
;$$ 
builder(( 
.(( 
Services(( 
.(( 
AddCors(( 
((( 
options((  
=>((! #
{)) 
options** 
.** 
AddDefaultPolicy** 
(** 
builder** $
=>**% '
{++ 
builder,, 
.,, 
WithOrigins,, 
(,, 
$str,, 3
),,3 4
... 
AllowAnyHeader.. 
(..  
)..  !
.// 
AllowAnyMethod// 
(//  
)//  !
.00 
AllowCredentials00 !
(00! "
)00" #
;00# $
}11 
)11 
;11 
}22 
)22 
;22 
builder:: 
.:: 
Services:: 
.:: 
AddControllers:: 
(::  
)::  !
;::! "
builder<< 
.<< 
Services<< 
.<< #
AddEndpointsApiExplorer<< (
(<<( )
)<<) *
;<<* +
builder== 
.== 
Services== 
.== 
AddSwaggerGen== 
(== 
)==  
;==  !
var@@ 
app@@ 
=@@ 	
builder@@
 
.@@ 
Build@@ 
(@@ 
)@@ 
;@@ 
ifCC 
(CC 
appCC 
.CC 
EnvironmentCC 
.CC 
IsDevelopmentCC !
(CC! "
)CC" #
)CC# $
{DD 
appEE 
.EE 

UseSwaggerEE 
(EE 
)EE 
;EE 
appFF 
.FF 
UseSwaggerUIFF 
(FF 
)FF 
;FF 
}GG 
appII 
.II 
UseHttpsRedirectionII 
(II 
)II 
;II 
appKK 
.KK 
UseAuthorizationKK 
(KK 
)KK 
;KK 
appMM 
.MM 

UseRoutingMM 
(MM 
)MM 
;MM 
appNN 
.NN 
UseCorsNN 
(NN 
)NN 
;NN 
appOO 
.OO 
UseEndpointsOO 
(OO 
	endpointsOO 
=>OO 
{PP 
	endpointsQQ 
.QQ 
MapControllersQQ 
(QQ 
)QQ 
;QQ 
}RR 
)RR 
;RR 
appVV 
.VV 
MapHubVV 

<VV
 
TimeHubVV 
>VV 
(VV 
$strVV 
)VV 
;VV  
appWW 
.WW 
MapHubWW 

<WW
 
TimeHubWW 
>WW 
(WW 
$strWW !
)WW! "
;WW" #
appZZ 
.ZZ 
MapControllersZZ 
(ZZ 
)ZZ 
;ZZ 
app\\ 
.\\ 
Run\\ 
(\\ 
)\\ 	
;\\	 
°
^D:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Models\Subasta.cs
	namespace 	
GreenPageAPI
 
. 
Models 
{ 
[ 
Table 

(
 
$str 
) 
] 
public 

class 
Subasta 
{ 
[		 	
Key			 
]		 
public

 
int

 
?

 
	IdSubasta

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
[ 	
Required	 
] 
public 
int 
? 
IdLibro 
{ 
get !
;! "
set# &
;& '
}( )
[ 	

ForeignKey	 
( 
$str 
) 
] 
public 
Libro 
Libro 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
Required	 
] 
public 
DateTime 
? 
	FecInicio "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
Required	 
] 
public 
DateTime 
? 
FecFinal !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
Required	 
] 
public 
double 

PrecioBase  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
int 
? 
	IdUsuario 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DateTime 
? 
	StartTime "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
? 
Duration 
{ 
get "
;" #
set$ '
;' (
}) *
public 
DateTime 
? 
EndTime  
{! "
get# &
;& '
set( +
;+ ,
}- .
public   
bool   
?   
isclosed   
{   
get    #
;  # $
set  % (
;  ( )
}  * +
}%% 
}&& ˜
]D:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Models\Oferta.cs
	namespace 	
GreenPageAPI
 
. 
Models 
{ 
[ 
Table 

(
 
$str 
) 
] 
public 

class 
Oferta 
{ 
[		 	
Key			 
]		 
public

 
int

 
IdOferta

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
[ 	
Required	 
] 
public 
int 
? 
	IdSubasta 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	

ForeignKey	 
( 
$str 
)  
]  !
public 
Usuario 
? 
usuario 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	

ForeignKey	 
( 
$str 
)  
]  !
public 
Subasta 
? 
subasta 
{  !
get! $
;$ %
set% (
;( )
}) *
[ 	
Required	 
] 
public 
double 
PrecioOferta "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
DateTime 
? 
	FecOferta "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 
? 
	IdUsuario 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} É 
\D:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Models\Libro.cs
	namespace 	
GreenPageAPI
 
. 
Models 
{ 
[ 
Table 

(
 
$str 
) 
] 
public 

class 
Libro 
{ 
[		 	
Key			 
]		 
public

 
int

 
?

 
IdLibro

 
{

 
get

 !
;

! "
set

# &
;

& '
}

( )
[ 	
Required	 
] 
public 
int 
? 
IdEditorial 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
] 
public 
int 
? 
IdGenero 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	

ForeignKey	 
( 
$str !
)! "
]" #
public 
	Editorial 
	Editorial "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	

ForeignKey	 
( 
$str 
) 
]  
public 
Genero 
Genero 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
	Destitulo 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
Required	 
] 
[ 	
StringLength	 
( 
$num 
) 
] 
public 
string 
Estado 
{ 
get "
;" #
set$ '
;' (
}) *
[!! 	
Required!!	 
]!! 
["" 	
StringLength""	 
("" 
$num"" 
)"" 
]"" 
public## 
string## 
ISBN## 
{## 
get##  
;##  !
set##" %
;##% &
}##' (
[%% 	
Required%%	 
]%% 
[&& 	
StringLength&&	 
(&& 
$num&& 
)&& 
]&& 
public'' 
string'' 
Sinopsys'' 
{''  
get''! $
;''$ %
set''& )
;'') *
}''+ ,
public)) 
int)) 
?)) 
	IdUsuario)) 
{)) 
get))  #
;))# $
set))% (
;))( )
}))* +
}** 
[-- 
Table-- 

(--
 
$str-- 
)-- 
]-- 
public.. 

class.. 
	Editorial.. 
{// 
[00 	
Key00	 
]00 
public11 
int11 
?11 
ideditorial11 
{11  !
get11" %
;11% &
set11' *
;11* +
}11, -
public22 
string22 
deseditorial22 "
{22# $
get22% (
;22( )
set22* -
;22- .
}22/ 0
}33 
[55 
Table55 

(55
 
$str55 
)55 
]55 
public66 

class66 
Genero66 
{77 
[88 	
Key88	 
]88 
public99 
int99 
?99 
idgenero99 
{99 
get99 "
;99" #
set99$ '
;99' (
}99) *
public:: 
string:: 
	desgenero:: 
{::  !
get::" %
;::% &
set::' *
;::* +
}::, -
};; 
}== ‡
gD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Models\GreenPageContext.cs
	namespace 	
GreenPageAPI
 
. 
Models 
{ 
public 

class 
GreenPageContext !
:" #
	DbContext$ -
{ 
public 
GreenPageContext 
(  
DbContextOptions  0
<0 1
GreenPageContext1 A
>A B
optionsC J
)J K
:L M
baseN R
(R S
optionsS Z
)Z [
{\ ]
}^ _
public		 
DbSet		 
<		 
Usuario		 
>		 
Usuarios		 &
{		' (
get		( +
;		+ ,
set		- 0
;		0 1
}		1 2
public

 
DbSet

 
<

 
Libro

 
>

 
Libros

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 
DbSet 
< 
Subasta 
> 
Subastas &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
DbSet 
< 
Oferta 
> 
Ofertas $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
	Editorial 
> 
Editoriales  +
{, -
get- 0
;0 1
set1 4
;4 5
}5 6
public 
DbSet 
< 
Genero 
> 
Generos $
{% &
get& )
;) *
set* -
;- .
}. /
} 
} ∆
\D:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Hubs\TimeHub.cs
public 
class 
TimeHub 
: 
Hub 
{ 
private 
static 
Timer 
_timer 
;  
private		 
static		 
IHubContext		 
<		 
TimeHub		 &
>		& '
_hubContext		( 3
;		3 4
public 

TimeHub 
( 
IHubContext 
< 
TimeHub &
>& '

hubContext( 2
)2 3
{ 
_hubContext 
= 

hubContext  
;  !
StartSendingTime 
( 
) 
; 
} 
private 
void 
StartSendingTime !
(! "
)" #
{ 
if 

( 
_timer 
== 
null 
) 
{ 	
_timer 
= 
new 
Timer 
( #
SendServerTimeToClients 6
,6 7
null8 <
,< =
TimeSpan> F
.F G
ZeroG K
,K L
TimeSpanM U
.U V
FromSecondsV a
(a b
$numb c
)c d
)d e
;e f
} 	
} 
private 
async 
void #
SendServerTimeToClients .
(. /
object/ 5
state6 ;
); <
{ 
var 
currentTime 
= 
DateTime "
." #
UtcNow# )
.) *
ToString* 2
(2 3
$str3 6
)6 7
;7 8
await 
_hubContext 
. 
Clients !
.! "
All" %
.% &
	SendAsync& /
(/ 0
$str0 C
,C D
currentTimeE P
)P Q
;Q R
} 
} Ü
uD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Controllers\WeatherForecastController.cs
	namespace 	
GreenPageAPI
 
. 
Controllers "
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class %
WeatherForecastController *
:+ ,
ControllerBase- ;
{ 
private		 
static		 
readonly		 
string		  &
[		& '
]		' (
	Summaries		) 2
=		3 4
new		5 8
[		8 9
]		9 :
{

 	
$str 
, 
$str !
,! "
$str# +
,+ ,
$str- 3
,3 4
$str5 ;
,; <
$str= C
,C D
$strE L
,L M
$strN S
,S T
$strU a
,a b
$strc n
} 	
;	 

private 
readonly 
ILogger  
<  !%
WeatherForecastController! :
>: ;
_logger< C
;C D
public %
WeatherForecastController (
(( )
ILogger) 0
<0 1%
WeatherForecastController1 J
>J K
loggerL R
)R S
{ 	
_logger 
= 
logger 
; 
} 	
[ 	
HttpGet	 
( 
Name 
= 
$str ,
), -
]- .
public 
IEnumerable 
< 
WeatherForecast *
>* +
Get, /
(/ 0
)0 1
{ 	
return 

Enumerable 
. 
Range #
(# $
$num$ %
,% &
$num' (
)( )
.) *
Select* 0
(0 1
index1 6
=>7 9
new: =
WeatherForecast> M
{ 
Date 
= 
DateOnly 
.  
FromDateTime  ,
(, -
DateTime- 5
.5 6
Now6 9
.9 :
AddDays: A
(A B
indexB G
)G H
)H I
,I J
TemperatureC 
= 
Random %
.% &
Shared& ,
., -
Next- 1
(1 2
-2 3
$num3 5
,5 6
$num7 9
)9 :
,: ;
Summary 
= 
	Summaries #
[# $
Random$ *
.* +
Shared+ 1
.1 2
Next2 6
(6 7
	Summaries7 @
.@ A
LengthA G
)G H
]H I
} 
) 
. 
ToArray 
( 
) 
; 
} 	
}   
}!! ¿j
mD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Controllers\UsuarioController.cs
	namespace		 	
GreenPageAPI		
 
.		 
Controllers		 "
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public 

class 
UsuarioController "
:# $
ControllerBase& 4
{ 
private 
readonly 
GreenPageContext )
_context* 2
;2 3
public 
UsuarioController  
(  !
GreenPageContext! 1
context2 9
)9 :
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpPut	 
( 
$str %
)% &
]& '
public 
async 
Task 
< 
IActionResult '
>' (
CambiarEstado) 6
(6 7
int7 :
id; =
,= >
[? @
FromBody@ H
]H I
boolJ N
nuevoEstadoO Z
)Z [
{ 	
var 
usuario 
= 
await 
_context  (
.( )
Usuarios) 1
.1 2
	FindAsync2 ;
(; <
id< >
)> ?
;? @
if 
( 
usuario 
== 
null 
)  
{ 
return   
NotFound   
(    
new    #
{  $ %
message  & -
=  . /
$str  0 G
}  H I
)  I J
;  J K
}!! 
usuario$$ 
.$$ 
isactive$$ 
=$$ 
nuevoEstado$$ *
;$$* +
_context%% 
.%% 
Entry%% 
(%% 
usuario%% "
)%%" #
.%%# $
State%%$ )
=%%* +
EntityState%%, 7
.%%7 8
Modified%%8 @
;%%@ A
try'' 
{(( 
await)) 
_context)) 
.)) 
SaveChangesAsync)) /
())/ 0
)))0 1
;))1 2
return** 
Ok** 
(** 
new** 
{** 
message**  '
=**( )
$str*** L
}**M N
)**N O
;**O P
}++ 
catch,, 
(,, 
DbUpdateException,, $
),,$ %
{-- 
return.. 

StatusCode.. !
(..! "
$num.." %
,..% &
new..' *
{..+ ,
message..- 4
=..5 6
$str..7 V
}..W X
)..X Y
;..Y Z
}// 
}00 	
[33 	
HttpGet33	 
(33 
$str33 
)33 
]33 
public44 
async44 
Task44 
<44 
ActionResult44 &
<44& '
IEnumerable44' 2
<442 3
Usuario443 :
>44: ;
>44; <
>44< =
GetUsuarios44> I
(44I J
)44J K
{55 	
var66 
usuarios66 
=66 
await66  
_context66! )
.66) *
Usuarios66* 2
.77 
Select77 
(77 
u77 
=>77 
new77 
{88 
u99 
.99 
	IdUsuario99 
,99 
PerfilNombre:: 
=:: 
u::  
.::  !
IdPerfil::! )
==::* ,
$num::- .
?::/ 0
$str::1 G
:::H I
$str::J Y
,::Y Z
u;; 
.;; 
IdPerfil;; 
,;; 
u<< 
.<< 
dni<< 
,<< 
u== 
.== 

NomUsuario== 
,== 
u>> 
.>> 

ApeUsuario>> 
,>> 
u?? 
.?? 
Login?? 
,?? 
u@@ 
.@@ 
Pass@@ 
,@@ 
uAA 
.AA 
FecCreacionAA 
,AA 
uBB 
.BB 
isactiveBB 
}CC 
)CC 
.DD 
ToListAsyncDD 
(DD 
)DD 
;DD 
returnFF 
OkFF 
(FF 
usuariosFF 
)FF 
;FF 
}GG 	
[II 	
HttpPostII	 
(II 
$strII %
)II% &
]II& '
publicJJ 
asyncJJ 
TaskJJ 
<JJ 
IActionResultJJ '
>JJ' (
CambiarContrasenaJJ) :
(JJ: ;
[JJ; <
FromBodyJJ< D
]JJD E
UsuarioModelJJF R
usuarioModelJJS _
)JJ_ `
{KK 	
ifLL 
(LL 
!LL 

ModelStateLL 
.LL  
IsValidLL  '
)LL' (
{MM 
returnNN 

BadRequestNN %
(NN% &

ModelStateNN& 0
)NN0 1
;NN1 2
}OO 
ifQQ 
(QQ 
stringQQ 
.QQ 
IsNullOrWhiteSpaceQQ -
(QQ- .
usuarioModelQQ. :
.QQ: ;
PassQQ; ?
)QQ? @
)QQ@ A
{RR 
returnSS 

BadRequestSS %
(SS% &
$strSS& K
)SSK L
;SSL M
}TT 
varWW 
userWW 
=WW 
awaitWW  
_contextWW! )
.WW) *
UsuariosWW* 2
.WW2 3
FirstOrDefaultAsyncWW3 F
(WWF G
uWWG H
=>WWI K
uXX 
.XX 
	IdUsuarioXX 
==XX 
usuarioModelXX +
.XX+ ,
UserXX, 0
)XX0 1
;XX1 2
ifZZ 
(ZZ 
userZZ 
==ZZ 
nullZZ  
)ZZ  !
{[[ 
return\\ 
NotFound\\ #
(\\# $
$str\\$ Y
)\\Y Z
;\\Z [
}]] 
var`` 
passwordPattern`` #
=``$ %
$str``& K
;``K L
ifaa 
(aa 
!aa 
Regexaa 
.aa 
IsMatchaa "
(aa" #
usuarioModelaa# /
.aa/ 0
Passaa0 4
,aa4 5
passwordPatternaa6 E
)aaE F
)aaF G
{bb 
returncc 

BadRequestcc %
(cc% &
$str	cc& Ç
)
ccÇ É
;
ccÉ Ñ
}dd 
userhh 
.hh 
Passhh 
=hh 
BCrypthh "
.hh" #
Nethh# &
.hh& '
BCrypthh' -
.hh- .
HashPasswordhh. :
(hh: ;
usuarioModelhh; G
.hhG H
PasshhH L
)hhL M
;hhM N
awaitkk 
_contextkk 
.kk 
SaveChangesAsynckk /
(kk/ 0
)kk0 1
;kk1 2
returnmm 
Okmm 
(mm 
newmm 
{mm 
messagemm  '
=mm( )
$strmm* P
}mmQ R
)mmR S
;mmS T
}nn 	
[qq 	

HttpDeleteqq	 
(qq 
$strqq 
)qq 
]qq 
publicrr 
asyncrr 
Taskrr 
<rr 
IActionResultrr '
>rr' (
EliminarUsuariorr) 8
(rr8 9
intrr9 <
idrr= ?
)rr? @
{ss 	
varuu 
usuariouu 
=uu 
awaituu 
_contextuu  (
.uu( )
Usuariosuu) 1
.uu1 2
	FindAsyncuu2 ;
(uu; <
iduu< >
)uu> ?
;uu? @
ifvv 
(vv 
usuariovv 
==vv 
nullvv 
)vv  
{ww 
returnxx 
NotFoundxx 
(xx  
newxx  #
{xx$ %
messagexx& -
=xx. /
$strxx0 G
}xxH I
)xxI J
;xxJ K
}yy 
_context|| 
.|| 
Usuarios|| 
.|| 
Remove|| $
(||$ %
usuario||% ,
)||, -
;||- .
try~~ 
{ 
await
ÄÄ 
_context
ÄÄ 
.
ÄÄ 
SaveChangesAsync
ÄÄ /
(
ÄÄ/ 0
)
ÄÄ0 1
;
ÄÄ1 2
return
ÅÅ 
Ok
ÅÅ 
(
ÅÅ 
new
ÅÅ 
{
ÅÅ 
message
ÅÅ  '
=
ÅÅ( )
$str
ÅÅ* K
}
ÅÅL M
)
ÅÅM N
;
ÅÅN O
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
DbUpdateException
ÉÉ $
)
ÉÉ$ %
{
ÑÑ 
return
ÖÖ 

StatusCode
ÖÖ !
(
ÖÖ! "
$num
ÖÖ" %
,
ÖÖ% &
new
ÖÖ' *
{
ÖÖ+ ,
message
ÖÖ- 4
=
ÖÖ5 6
$str
ÖÖ7 U
}
ÖÖV W
)
ÖÖW X
;
ÖÖX Y
}
ÜÜ 
}
áá 	
[
ää 	
HttpPut
ää	 
(
ää 
$str
ää 
)
ää 
]
ää 
public
ãã 
async
ãã 
Task
ãã 
<
ãã 
IActionResult
ãã '
>
ãã' (
EditarUsuario
ãã) 6
(
ãã6 7
int
ãã7 :
id
ãã; =
,
ãã= >
[
ãã? @
FromBody
ãã@ H
]
ããH I
UsuarioUpdt
ããJ U 
usuarioActualizado
ããV h
)
ããh i
{
åå 	
var
éé 
usuario
éé 
=
éé 
await
éé 
_context
éé  (
.
éé( )
Usuarios
éé) 1
.
éé1 2
	FindAsync
éé2 ;
(
éé; <
id
éé< >
)
éé> ?
;
éé? @
if
èè 
(
èè 
usuario
èè 
==
èè 
null
èè 
)
èè  
{
êê 
return
ëë 
NotFound
ëë 
(
ëë  
new
ëë  #
{
ëë$ %
message
ëë& -
=
ëë. /
$str
ëë0 G
}
ëëH I
)
ëëI J
;
ëëJ K
}
íí 
usuario
ïï 
.
ïï 
IdPerfil
ïï 
=
ïï  
usuarioActualizado
ïï 1
.
ïï1 2
idPerfil
ïï2 :
;
ïï: ;
usuario
ññ 
.
ññ 

NomUsuario
ññ 
=
ññ   
usuarioActualizado
ññ! 3
.
ññ3 4

nomUsuario
ññ4 >
;
ññ> ?
usuario
óó 
.
óó 

ApeUsuario
óó 
=
óó   
usuarioActualizado
óó! 3
.
óó3 4

apeUsuario
óó4 >
;
óó> ?
usuario
òò 
.
òò 
dni
òò 
=
òò  
usuarioActualizado
òò ,
.
òò, -
dni
òò- 0
;
òò0 1
usuario
ôô 
.
ôô 
Login
ôô 
=
ôô  
usuarioActualizado
ôô .
.
ôô. /
login
ôô/ 4
;
ôô4 5
_context
úú 
.
úú 
Entry
úú 
(
úú 
usuario
úú "
)
úú" #
.
úú# $
State
úú$ )
=
úú* +
EntityState
úú, 7
.
úú7 8
Modified
úú8 @
;
úú@ A
try
ûû 
{
üü 
await
†† 
_context
†† 
.
†† 
SaveChangesAsync
†† /
(
††/ 0
)
††0 1
;
††1 2
return
°° 
Ok
°° 
(
°° 
new
°° 
{
°° 
message
°°  '
=
°°( )
$str
°°* M
}
°°N O
)
°°O P
;
°°P Q
}
¢¢ 
catch
££ 
(
££ 
DbUpdateException
££ $
)
££$ %
{
§§ 
return
•• 

StatusCode
•• !
(
••! "
$num
••" %
,
••% &
new
••' *
{
••+ ,
message
••- 4
=
••5 6
$str
••7 W
}
••X Y
)
••Y Z
;
••Z [
}
¶¶ 
}
ßß 	
}
´´ 
public
≠≠ 

class
≠≠ 
UsuarioUpdt
≠≠ 
{
ÆÆ 
public
ØØ 
int
ØØ 
idPerfil
ØØ 
{
ØØ 
get
ØØ  
;
ØØ  !
set
ØØ! $
;
ØØ$ %
}
ØØ% &
public
∞∞ 
string
∞∞ 

nomUsuario
∞∞  
{
∞∞! "
get
∞∞" %
;
∞∞% &
set
∞∞& )
;
∞∞) *
}
∞∞* +
public
±± 
string
±± 

apeUsuario
±±  
{
±±! "
get
±±" %
;
±±% &
set
±±& )
;
±±) *
}
±±* +
public
≤≤ 
string
≤≤ 
dni
≤≤ 
{
≤≤ 
get
≤≤ 
;
≤≤ 
set
≤≤ !
;
≤≤! "
}
≤≤" #
public
≥≥ 
string
≥≥ 
login
≥≥ 
{
≥≥ 
get
≥≥ 
;
≥≥  
set
≥≥  #
;
≥≥# $
}
≥≥$ %
}
µµ 
public
∑∑ 

class
∑∑ 
UsuarioModel
∑∑ 
{
∏∏ 
[
ππ 	
Required
ππ	 
]
ππ 
public
∫∫ 
int
∫∫ 
User
∫∫ 
{
∫∫ 
get
∫∫ 
;
∫∫ 
set
∫∫ "
;
∫∫" #
}
∫∫$ %
[
ºº 	
Required
ºº	 
]
ºº 
public
ΩΩ 
string
ΩΩ 
Pass
ΩΩ 
{
ΩΩ 
get
ΩΩ 
;
ΩΩ  
set
ΩΩ  #
;
ΩΩ# $
}
ΩΩ$ %
}
ææ 
}¿¿ “y
mD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Controllers\SubastaController.cs
	namespace 	
GreenPageAPI
 
. 
Controllers "
{ 
[		 
ApiController		 
]		 
[

 
Route

 

(


 
$str

 
)

 
]

 
public 

class 
SubastaController "
:# $

Controller% /
{ 
private 
readonly 
GreenPageContext )
_context* 2
;2 3
public 
SubastaController  
(  !
GreenPageContext! 1
context2 9
)9 :
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
Subasta3 :
>: ;
>; <
>< =
GetSubastas> I
(I J
)J K
{ 	
return 
await 
_context !
.! "
Subastas" *
.* +
ToListAsync+ 6
(6 7
)7 8
;8 9
} 	
[ 	
HttpGet	 
( 
$str ,
), -
]- .
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
dynamic3 :
>: ;
>; <
>< =%
ListarSubastasConDetalles> W
(W X
)X Y
{ 	
var 
subastasConDetalles #
=$ %
await& +
_context, 4
.4 5
Subastas5 =
. 
Include 
( 
s 
=> 
s 
.  
Libro  %
)% &
. 
Select 
( 
s 
=> 
new  
{   
idlibro!! 
=!! 
s!! 
.!!  
IdLibro!!  '
,!!' (
	idsubasta"" 
="" 
s""  !
.""! "
	IdSubasta""" +
,""+ ,
TituloLibro## 
=##  !
s##" #
.### $
Libro##$ )
.##) *
	Destitulo##* 3
,##3 4
estado$$ 
=$$ 
s$$ 
.$$ 
Libro$$ $
.$$$ %
Estado$$% +
,$$+ ,
Sinopsis%% 
=%% 
s%%  
.%%  !
Libro%%! &
.%%& '
Sinopsys%%' /
,%%/ 0
FechaInicio&& 
=&&  !
s&&" #
.&&# $
	FecInicio&&$ -
,&&- .
FechaFin'' 
='' 
s''  
.''  !
FecFinal''! )
,'') *

PrecioBase(( 
=((  
s((! "
.((" #

PrecioBase((# -
,((- .
isclosed)) 
=)) 
s))  
.))  !
isclosed))! )
}** 
)** 
.++ 
OrderByDescending++ "
(++" #
s++# $
=>++% '
s++( )
.++) *
FechaFin++* 2
)++2 3
.,, 
ToListAsync,, 
(,, 
),, 
;,, 
return.. 
Ok.. 
(.. 
subastasConDetalles.. )
)..) *
;..* +
}// 	
[11 	
HttpGet11	 
(11 
$str11 
)11 
]11 
public22 
async22 
Task22 
<22 
ActionResult22 &
<22& '
Subasta22' .
>22. /
>22/ 0

GetSubasta221 ;
(22; <
int22< ?
id22@ B
)22B C
{33 	
var44 
subasta44 
=44 
await44 
_context44  (
.44( )
Subastas44) 1
.55( )
Where55) .
(55. /
s55/ 0
=>551 3
s554 5
.555 6
	IdSubasta556 ?
==55@ B
id55C E
)55E F
.66( )
FirstOrDefaultAsync66) <
(66< =
)66= >
;66> ?
if88 
(88 
subasta88 
==88 
null88 
)88  
{99 
return:: 
NotFound:: 
(::  
)::  !
;::! "
};; 
return== 
Ok== 
(== 
subasta== 
)== 
;== 
}>> 	
[BB 	
HttpPostBB	 
]BB 
publicCC 
asyncCC 
TaskCC 
<CC 
ActionResultCC &
<CC& '
SubastaCC' .
>CC. /
>CC/ 0
PostSubastaCC1 <
(CC< =
SubastaCC= D
subastaCCE L
)CCL M
{DD 	
_contextEE 
.EE 
SubastasEE 
.EE 
AddEE !
(EE! "
subastaEE" )
)EE) *
;EE* +
awaitFF 
_contextFF 
.FF 
SaveChangesAsyncFF +
(FF+ ,
)FF, -
;FF- .
returnHH 
CreatedAtActionHH "
(HH" #
nameofHH# )
(HH) *

GetSubastaHH* 4
)HH4 5
,HH5 6
newHH7 :
{HH; <
idHH= ?
=HH@ A
subastaHHB I
.HHI J
	IdSubastaHHJ S
}HHT U
,HHU V
subastaHHW ^
)HH^ _
;HH_ `
}II 	
[KK 	
HttpPutKK	 
(KK 
$strKK 
)KK 
]KK 
publicLL 
asyncLL 
TaskLL 
<LL 
IActionResultLL '
>LL' (

PutSubastaLL) 3
(LL3 4
intLL4 7
idLL8 :
,LL: ;
SubastaLL< C
subastaLLD K
)LLK L
{MM 	
ifNN 
(NN 
idNN 
!=NN 
subastaNN 
.NN 
	IdSubastaNN '
)NN' (
{OO 
returnPP 

BadRequestPP !
(PP! "
)PP" #
;PP# $
}QQ 
_contextSS 
.SS 
EntrySS 
(SS 
subastaSS "
)SS" #
.SS# $
StateSS$ )
=SS* +
EntityStateSS, 7
.SS7 8
ModifiedSS8 @
;SS@ A
tryUU 
{VV 
awaitWW 
_contextWW 
.WW 
SaveChangesAsyncWW /
(WW/ 0
)WW0 1
;WW1 2
}XX 
catchYY 
(YY (
DbUpdateConcurrencyExceptionYY /
)YY/ 0
{ZZ 
if[[ 
([[ 
![[ 
_context[[ 
.[[ 
Subastas[[ &
.[[& '
Any[[' *
([[* +
e[[+ ,
=>[[- /
e[[0 1
.[[1 2
	IdSubasta[[2 ;
==[[< >
id[[? A
)[[A B
)[[B C
{\\ 
return]] 
NotFound]] #
(]]# $
)]]$ %
;]]% &
}^^ 
else__ 
{`` 
throwaa 
;aa 
}bb 
}cc 
returndd 
	NoContentdd 
(dd 
)dd 
;dd 
}ee 	
[gg 	

HttpDeletegg	 
(gg 
$strgg 
)gg 
]gg 
publichh 
asynchh 
Taskhh 
<hh 
IActionResulthh '
>hh' (
DeleteSubastahh) 6
(hh6 7
inthh7 :
idhh; =
)hh= >
{ii 	
varjj 
subastajj 
=jj 
awaitjj 
_contextjj  (
.jj( )
Subastasjj) 1
.jj1 2
	FindAsyncjj2 ;
(jj; <
idjj< >
)jj> ?
;jj? @
ifkk 
(kk 
subastakk 
==kk 
nullkk 
)kk  
{ll 
returnmm 
NotFoundmm 
(mm  
)mm  !
;mm! "
}nn 
_contextpp 
.pp 
Subastaspp 
.pp 
Removepp $
(pp$ %
subastapp% ,
)pp, -
;pp- .
awaitqq 
_contextqq 
.qq 
SaveChangesAsyncqq +
(qq+ ,
)qq, -
;qq- .
returnss 
	NoContentss 
(ss 
)ss 
;ss 
}tt 	
[vv 	
HttpPostvv	 
(vv 
$strvv 
)vv 
]vv 
publicww 
asyncww 
Taskww 
<ww 
IActionResultww '
>ww' (
IniciarSubastaww) 7
(ww7 8
[ww8 9
FromBodyww9 A
]wwA B
intwwC F
	idSubastawwG P
)wwP Q
{xx 	
varyy 
subastayy 
=yy 
awaityy 
_contextyy  (
.yy( )
Subastasyy) 1
.yy1 2
	FindAsyncyy2 ;
(yy; <
	idSubastayy< E
)yyE F
;yyF G
if{{ 
({{ 
subasta{{ 
=={{ 
null{{ 
){{  
{|| 
return}} 
NotFound}} 
(}}  
$str}}  S
)}}S T
;}}T U
}~~ 
if
ÄÄ 
(
ÄÄ 
subasta
ÄÄ 
.
ÄÄ 
isclosed
ÄÄ  
==
ÄÄ! #
true
ÄÄ$ (
)
ÄÄ( )
{
ÅÅ 
return
ÇÇ 
NotFound
ÇÇ 
(
ÇÇ  
$str
ÇÇ  E
)
ÇÇE F
;
ÇÇF G
}
ÉÉ 
if
ãã 
(
ãã 
!
ãã 
subasta
ãã 
.
ãã 
	StartTime
ãã &
.
ãã& '
HasValue
ãã' /
)
ãã/ 0
{
åå 
var
çç 
tiempoDuracion
çç &
=
çç' (
TimeSpan
çç) 1
.
çç1 2
FromSeconds
çç2 =
(
çç= >
$num
çç> @
)
çç@ A
;
ççA B
subasta
éé 
.
éé 
isclosed
éé $
=
éé% &
false
éé' ,
;
éé, -
subasta
èè 
.
èè 
	StartTime
èè %
=
èè& '
DateTime
èè( 0
.
èè0 1
UtcNow
èè1 7
;
èè7 8
subasta
êê 
.
êê 
EndTime
êê #
=
êê$ %
subasta
êê& -
.
êê- .
	StartTime
êê. 7
.
êê7 8
Value
êê8 =
.
êê= >
Add
êê> A
(
êêA B
tiempoDuracion
êêB P
)
êêP Q
;
êêQ R
_context
íí 
.
íí 
Subastas
íí %
.
íí% &
Update
íí& ,
(
íí, -
subasta
íí- 4
)
íí4 5
;
íí5 6
await
ìì 
_context
ìì "
.
ìì" #
SaveChangesAsync
ìì# 3
(
ìì3 4
)
ìì4 5
;
ìì5 6
}
îî 
return
ïï 
Ok
ïï 
(
ïï 
new
ïï 
{
ïï 
	startTime
ïï  )
=
ïï* +
subasta
ïï, 3
.
ïï3 4
	StartTime
ïï4 =
,
ïï= >
endTime
ïï? F
=
ïïG H
subasta
ïïI P
.
ïïP Q
EndTime
ïïQ X
}
ïïY Z
)
ïïZ [
;
ïï[ \
}
ññ 	
[
öö 	
HttpGet
öö	 
(
öö 
$str
öö '
)
öö' (
]
öö( )
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
IActionResult
õõ '
>
õõ' (#
ObtenerTiempoRestante
õõ) >
(
õõ> ?
int
õõ? B
id
õõC E
)
õõE F
{
úú 	
var
ùù 
subasta
ùù 
=
ùù 
await
ùù 
_context
ùù  (
.
ùù( )
Subastas
ùù) 1
.
ùù1 2
	FindAsync
ùù2 ;
(
ùù; <
id
ùù< >
)
ùù> ?
;
ùù? @
if
ûû 
(
ûû 
subasta
ûû 
==
ûû 
null
ûû 
||
ûû  "
subasta
ûû# *
.
ûû* +
EndTime
ûû+ 2
==
ûû3 5
null
ûû6 :
)
ûû: ;
{
üü 
return
†† 
NotFound
†† 
(
††  
)
††  !
;
††! "
}
°° 
var
•• 
tiempoRestante
•• 
=
••  
(
••! "
int
••" %
)
••% &
Math
••& *
.
••* +
Max
••+ .
(
••. /
$num
••/ 0
,
••0 1
(
••2 3
subasta
••3 :
.
••: ;
EndTime
••; B
.
••B C
Value
••C H
-
••I J
DateTime
••K S
.
••S T
UtcNow
••T Z
)
••Z [
.
••[ \
TotalSeconds
••\ h
)
••h i
;
••i j
return
®® 
Ok
®® 
(
®® 
new
®® 
{
®® 
tiempoRestante
®® *
}
®®+ ,
)
®®, -
;
®®- .
}
©© 	
[
≠≠ 	
HttpGet
≠≠	 
(
≠≠ 
$str
≠≠ &
)
≠≠& '
]
≠≠' (
public
ÆÆ 
async
ÆÆ 
Task
ÆÆ 
<
ÆÆ 
IActionResult
ÆÆ '
>
ÆÆ' (
CerrarSubasta
ÆÆ) 6
(
ÆÆ6 7
int
ÆÆ7 :
id
ÆÆ; =
)
ÆÆ= >
{
ØØ 	
var
∞∞ 
subasta
∞∞ 
=
∞∞ 
await
∞∞ 
_context
∞∞  (
.
∞∞( )
Subastas
∞∞) 1
.
∞∞1 2
	FindAsync
∞∞2 ;
(
∞∞; <
id
∞∞< >
)
∞∞> ?
;
∞∞? @
if
±± 
(
±± 
subasta
±± 
==
±± 
null
±± 
||
±±  "
subasta
±±# *
.
±±* +
	StartTime
±±+ 4
==
±±5 7
null
±±8 <
)
±±< =
{
≤≤ 
return
≥≥ 
NotFound
≥≥ 
(
≥≥  
$str
≥≥  V
)
≥≥V W
;
≥≥W X
}
¥¥ 
subasta
∂∂ 
.
∂∂ 
isclosed
∂∂ 
=
∂∂ 
true
∂∂ #
;
∂∂# $
_context
∑∑ 
.
∑∑ 
Subastas
∑∑ 
.
∑∑ 
Update
∑∑ $
(
∑∑$ %
subasta
∑∑% ,
)
∑∑, -
;
∑∑- .
await
∏∏ 
_context
∏∏ 
.
∏∏ 
SaveChangesAsync
∏∏ +
(
∏∏+ ,
)
∏∏, -
;
∏∏- .
return
∫∫ 
Ok
∫∫ 
(
∫∫ 
new
∫∫ 
{
∫∫ 
subasta
ªª 
,
ªª 
mensaje
ºº 
=
ºº 
$str
ºº 9
}
ΩΩ 
)
ΩΩ 
;
ΩΩ 
}
ææ 	
}
¡¡ 
public
ƒƒ 	
class
ƒƒ
 
Subastastart
ƒƒ 
{≈≈ 
public
∆∆ 

int
∆∆ 
	IdSubasta
∆∆ 
{
∆∆ 
get
∆∆ 
;
∆∆ 
set
∆∆  #
;
∆∆# $
}
∆∆% &
public
«« 

DateTime
«« 
?
«« 
	StartTime
«« 
{
««  
get
««! $
;
««$ %
set
««& )
;
««) *
}
««+ ,
public
»» 

DateTime
»» 
?
»» 
EndTime
»» 
{
»» 
get
»» "
;
»»" #
set
»»$ '
;
»»' (
}
»») *
}…… 
}ÃÃ ø_
lD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Controllers\OfertaController.cs
	namespace 	
GreenPageAPI
 
. 
Controllers "
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public		 

class		 
OfertaController		 !
:		" #

Controller		$ .
{

 
private 
readonly 
GreenPageContext )
_context* 2
;2 3
public 
OfertaController 
(  
GreenPageContext  0
context1 8
)8 9
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
Oferta3 9
>9 :
>: ;
>; <

GetOfertas= G
(G H
)H I
{ 	
return 
await 
_context !
.! "
Ofertas" )
.) *
ToListAsync* 5
(5 6
)6 7
;7 8
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
async 
Task 
< 
ActionResult &
<& '
Oferta' -
>- .
>. /
	GetOferta0 9
(9 :
int: =
id> @
)@ A
{ 	
var 
oferta 
= 
await 
_context '
.' (
Ofertas( /
./ 0
	FindAsync0 9
(9 :
id: <
)< =
;= >
if 
( 
oferta 
== 
null 
) 
{ 
return   
NotFound   
(    
)    !
;  ! "
}!! 
return## 
oferta## 
;## 
}$$ 	
[&& 	
HttpPost&&	 
]&& 
public'' 
async'' 
Task'' 
<'' 
ActionResult'' &
<''& '
Oferta''' -
>''- .
>''. /

PostOferta''0 :
('': ;
Oferta''; A
oferta''B H
)''H I
{(( 	
if)) 
()) 
oferta)) 
==)) 
null)) 
))) 
{** 
return++ 

BadRequest++ !
(++! "
$str++" =
)++= >
;++> ?
},, 
var// 
ultimaOferta// 
=// 
await// $
_context//% -
.//- .
Ofertas//. 5
.00 
Where00 
(00 
o00 
=>00 
o00 
.00 
	IdSubasta00 '
==00( *
oferta00+ 1
.001 2
	IdSubasta002 ;
)00; <
.11 
OrderByDescending11 "
(11" #
o11# $
=>11% '
o11( )
.11) *
PrecioOferta11* 6
)116 7
.22 
FirstOrDefaultAsync22 $
(22$ %
)22% &
;22& '
if55 
(55 
ultimaOferta55 
!=55 
null55  $
&&55% '
oferta55( .
.55. /
PrecioOferta55/ ;
<=55< >
ultimaOferta55? K
.55K L
PrecioOferta55L X
)55X Y
{66 
return77 

BadRequest77 !
(77! "
$"77" $
$str77$ ^
{77^ _
ultimaOferta77_ k
.77k l
PrecioOferta77l x
}77x y
$str77y z
"77z {
)77{ |
;77| }
}88 
_context99 
.99 
Ofertas99 
.99 
Add99  
(99  !
oferta99! '
)99' (
;99( )
await:: 
_context:: 
.:: 
SaveChangesAsync:: +
(::+ ,
)::, -
;::- .
return<< 
CreatedAtAction<< "
(<<" #
nameof<<# )
(<<) *
	GetOferta<<* 3
)<<3 4
,<<4 5
new<<6 9
{<<: ;
id<<< >
=<<? @
oferta<<A G
.<<G H
IdOferta<<H P
}<<Q R
,<<R S
oferta<<T Z
)<<Z [
;<<[ \
}== 	
[?? 	
HttpGet??	 
(?? 
$str?? )
)??) *
]??* +
public@@ 
async@@ 
Task@@ 
<@@ 
ActionResult@@ &
>@@& '

GetGanador@@( 2
(@@2 3
int@@3 6
	idSubasta@@7 @
)@@@ A
{AA 	
varCC 
ofertaGanadoraCC 
=CC  
awaitCC! &
_contextCC' /
.CC/ 0
OfertasCC0 7
.DD 
WhereDD 
(DD 
oDD 
=>DD 
oDD 
.DD 
	IdSubastaDD #
==DD$ &
	idSubastaDD' 0
)DD0 1
.EE 
OrderByDescendingEE 
(EE 
oEE  
=>EE  "
oEE" #
.EE# $
PrecioOfertaEE$ 0
)EE0 1
.FF 
SelectFF 
(FF 
oFF 
=>FF 
newFF 
{GG 
oHH 
.HH 
PrecioOfertaHH 
,HH 
oII 
.II 
	IdUsuarioII 
,II 
UsuarioJJ 
=JJ 
newJJ 
{KK 
oLL 
.LL 
usuarioLL 
.LL 
	IdUsuarioLL '
,LL' (
oMM 
.MM 
usuarioMM 
.MM 

NomUsuarioMM (
,MM( )
oNN 
.NN 
usuarioNN 
.NN 

ApeUsuarioNN (
,NN( )
oOO 
.OO 
usuarioOO 
.OO 
LoginOO #
}PP 
}QQ 
)QQ 
.RR 	
FirstOrDefaultAsyncRR	 
(RR 
)RR 
;RR 
ifUU 

(UU 
ofertaGanadoraUU 
==UU 
nullUU "
)UU" #
{VV 	
returnWW 
NotFoundWW 
(WW 
$strWW <
)WW< =
;WW= >
}XX 	
return\\ 
Ok\\ 
(\\ 
new\\ 
{]] 	
Mensaje^^ 
=^^ 
$str^^ -
,^^- .
PrecioGanador__ 
=__ 
ofertaGanadora__ *
.__* +
PrecioOferta__+ 7
,__7 8
UsuarioGanador`` 
=`` 
$"`` 
{``  
ofertaGanadora``  .
.``. /
Usuario``/ 6
.``6 7

NomUsuario``7 A
}``A B
$str``B C
{``C D
ofertaGanadora``D R
.``R S
Usuario``S Z
.``Z [

ApeUsuario``[ e
[``e f
$num``f g
]``g h
}``h i
$str``i j
"``j k
}aa 	
)aa	 

;aa
 
}cc 	
[ee 	
HttpGetee	 
(ee 
$stree 3
)ee3 4
]ee4 5
publicff 
asyncff 
Taskff 
<ff 
ActionResultff &
>ff& ' 
GetOfertasPorUsuarioff( <
(ff< =
intff= @
	usuarioIdffA J
)ffJ K
{gg 	
varii 
ofertasusuarioii 
=ii  
awaitii! &
_contextii' /
.ii/ 0
Ofertasii0 7
.jj 
Wherejj 
(jj 
ojj 
=>jj 
ojj 
.jj 
	IdUsuariojj "
==jj# %
	usuarioIdjj& /
)jj/ 0
.kk 
Selectkk 
(kk 
okk 
=>kk 
newkk 
{ll 
omm 
.mm 
IdOfertamm 
,mm 
onn 
.nn 
subastann 
.nn 
Libronn 
.nn  
	Destitulonn  )
,nn) *
ooo 
.oo 
PrecioOfertaoo 
,oo 
opp 
.pp 
	FecOfertapp 
}qq 
)qq 
.rr 
ToListAsyncrr 
(rr 
)rr 
;rr 
iftt 
(tt 
ofertasusuariott 
==tt !
nulltt" &
||tt' )
!tt* +
ofertasusuariott+ 9
.tt9 :
Anytt: =
(tt= >
)tt> ?
)tt? @
{uu 
returnvv 
NotFoundvv 
(vv  
$strvv  C
)vvC D
;vvD E
}ww 
returnyy 
Okyy 
(yy 
ofertasusuarioyy $
)yy$ %
;yy% &
}{{ 	
[}} 	
HttpPut}}	 
(}} 
$str}} 
)}} 
]}} 
public~~ 
async~~ 
Task~~ 
<~~ 
IActionResult~~ '
>~~' (
	PutOferta~~) 2
(~~2 3
int~~3 6
id~~7 9
,~~9 :
Oferta~~; A
oferta~~B H
)~~H I
{ 	
if
ÄÄ 
(
ÄÄ 
id
ÄÄ 
!=
ÄÄ 
oferta
ÄÄ 
.
ÄÄ 
IdOferta
ÄÄ %
)
ÄÄ% &
{
ÅÅ 
return
ÇÇ 

BadRequest
ÇÇ !
(
ÇÇ! "
)
ÇÇ" #
;
ÇÇ# $
}
ÉÉ 
_context
ÖÖ 
.
ÖÖ 
Entry
ÖÖ 
(
ÖÖ 
oferta
ÖÖ !
)
ÖÖ! "
.
ÖÖ" #
State
ÖÖ# (
=
ÖÖ) *
EntityState
ÖÖ+ 6
.
ÖÖ6 7
Modified
ÖÖ7 ?
;
ÖÖ? @
try
áá 
{
àà 
await
ââ 
_context
ââ 
.
ââ 
SaveChangesAsync
ââ /
(
ââ/ 0
)
ââ0 1
;
ââ1 2
}
ää 
catch
ãã 
(
ãã *
DbUpdateConcurrencyException
ãã /
)
ãã/ 0
{
åå 
if
çç 
(
çç 
!
çç 
_context
çç 
.
çç 
Ofertas
çç %
.
çç% &
Any
çç& )
(
çç) *
e
çç* +
=>
çç, .
e
çç/ 0
.
çç0 1
IdOferta
çç1 9
==
çç: <
id
çç= ?
)
çç? @
)
çç@ A
{
éé 
return
èè 
NotFound
èè #
(
èè# $
)
èè$ %
;
èè% &
}
êê 
else
ëë 
{
íí 
throw
ìì 
;
ìì 
}
îî 
}
ïï 
return
óó 
	NoContent
óó 
(
óó 
)
óó 
;
óó 
}
òò 	
[
öö 	

HttpDelete
öö	 
(
öö 
$str
öö 
)
öö 
]
öö 
public
õõ 
async
õõ 
Task
õõ 
<
õõ 
IActionResult
õõ '
>
õõ' (
DeleteOferta
õõ) 5
(
õõ5 6
int
õõ6 9
id
õõ: <
)
õõ< =
{
úú 	
var
ùù 
oferta
ùù 
=
ùù 
await
ùù 
_context
ùù '
.
ùù' (
Ofertas
ùù( /
.
ùù/ 0
	FindAsync
ùù0 9
(
ùù9 :
id
ùù: <
)
ùù< =
;
ùù= >
if
ûû 
(
ûû 
oferta
ûû 
==
ûû 
null
ûû 
)
ûû 
{
üü 
return
†† 
NotFound
†† 
(
††  
)
††  !
;
††! "
}
°° 
_context
££ 
.
££ 
Ofertas
££ 
.
££ 
Remove
££ #
(
££# $
oferta
££$ *
)
££* +
;
££+ ,
await
§§ 
_context
§§ 
.
§§ 
SaveChangesAsync
§§ +
(
§§+ ,
)
§§, -
;
§§- .
return
¶¶ 
	NoContent
¶¶ 
(
¶¶ 
)
¶¶ 
;
¶¶ 
}
ßß 	
}
®® 
}©© úq
kD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Controllers\LibroController.cs
	namespace 	
GreenPageAPI
 
. 
Controllers "
{ 
[ 
ApiController 
] 
[ 
Route 

(
 
$str 
) 
] 
public		 

class		 
LibroController		  
:		! "
ControllerBase		$ 2
{

 
private 
readonly 
GreenPageContext )
_context* 2
;2 3
public 
LibroController 
( 
GreenPageContext /
context0 7
)7 8
{ 	
_context 
= 
context 
; 
} 	
[ 	
HttpGet	 
] 
public 
async 
Task 
< 
ActionResult &
<& '
IEnumerable' 2
<2 3
Libro3 8
>8 9
>9 :
>: ;
	GetLibros< E
(E F
)F G
{ 	
var 
libros 
= 
await 
_context '
.' (
Libros( .
. 
Include 
( 
l 
=> 
l 
. 
	Editorial %
)% &
. 
Include 
( 
l 
=> 
l 
. 
Genero "
)" #
. 
Select 
( 
l 
=> 
new 
{ 
l!! 
.!! 
IdLibro!! 
,!! 
l"" 
."" 
	Destitulo"" 
,"" 
l## 
.## 
Estado## 
,## 
l$$ 
.$$ 
ISBN$$ 
,$$ 
l%% 
.%% 
Sinopsys%% 
,%% 
l&& 
.&& 
IdEditorial&& 
,&& 
l'' 
.'' 
IdGenero'' 
,'' 
	Editorial(( 
=(( 
l(( 
.(( 
	Editorial(( '
.((' (
deseditorial((( 4
,((4 5
Genero)) 
=)) 
l)) 
.)) 
Genero)) !
.))! "
	desgenero))" +
}** 
)** 
.++ 
ToListAsync++ 
(++ 
)++ 
;++ 
return-- 
Ok-- 
(-- 
libros-- 
)-- 
;-- 
}// 	
[11 	
HttpGet11	 
(11 
$str11 
)11 
]11 
public22 
async22 
Task22 
<22 
ActionResult22 &
<22& '
Libro22' ,
>22, -
>22- .
GetLibro22/ 7
(227 8
int228 ;
id22< >
)22> ?
{33 	
var44 
libro44 
=44 
await44 
_context44 &
.44& '
Libros44' -
.44- .
	FindAsync44. 7
(447 8
id448 :
)44: ;
;44; <
if66 
(66 
libro66 
==66 
null66 
)66 
{77 
return88 
NotFound88 
(88  
)88  !
;88! "
}99 
return:: 
libro:: 
;:: 
};; 	
[== 	
HttpPost==	 
]== 
public>> 
async>> 
Task>> 
<>> 
ActionResult>> &
<>>& '
Libro>>' ,
>>>, -
>>>- .
	PostLibro>>/ 8
(>>8 9
LibroConSubasta>>9 H
libroConSubasta?? 
)?? 
{@@ 	
varCC 
libroCC 
=CC 
newCC 
LibroCC !
{DD 
IdEditorialEE 
=EE 
libroConSubastaEE -
.EE- .
IdEditorialEE. 9
,EE9 :
IdGeneroFF 
=FF 
libroConSubastaFF *
.FF* +
IdGeneroFF+ 3
,FF3 4
	DestituloGG 
=GG 
libroConSubastaGG +
.GG+ ,
	DestituloGG, 5
,GG5 6
EstadoHH 
=HH 
libroConSubastaHH (
.HH( )
EstadoHH) /
,HH/ 0
ISBNII 
=II 
libroConSubastaII &
.II& '
ISBNII' +
,II+ ,
SinopsysJJ 
=JJ 
libroConSubastaJJ *
.JJ* +
SinopsysJJ+ 3
,JJ3 4
	IdUsuarioKK 
=KK 
libroConSubastaKK +
.KK+ ,
	IdUsuarioKK, 5
}LL 
;LL 
_context\\ 
.\\ 
Libros\\ 
.\\ 
Add\\ 
(\\  
libro\\  %
)\\% &
;\\& '
await]] 
_context]] 
.]] 
SaveChangesAsync]] +
(]]+ ,
)]], -
;]]- .
var`` 
nuevaSubasta``  
=``! "
new``# &
Subasta``' .
{aa 
IdLibrobb 
=bb 
librobb #
.bb# $
IdLibrobb$ +
,bb+ ,
	FecIniciocc 
=cc 
libroConSubastacc  /
.cc/ 0
	FecIniciocc0 9
,cc9 :
FecFinaldd 
=dd 
libroConSubastadd .
.dd. /
FecFinaldd/ 7
,dd7 8

PrecioBaseee 
=ee  
libroConSubastaee! 0
.ee0 1

PrecioBaseee1 ;
,ee; <
	IdUsuarioff 
=ff 
libroConSubastaff  /
.ff/ 0
	IdUsuarioff0 9
}gg 
;gg 
_contextjj 
.jj 
Subastasjj !
.jj! "
Addjj" %
(jj% &
nuevaSubastajj& 2
)jj2 3
;jj3 4
awaitkk 
_contextkk 
.kk 
SaveChangesAsynckk /
(kk/ 0
)kk0 1
;kk1 2
returnmm 
CreatedAtActionmm "
(mm" #
nameofmm# )
(mm) *
GetLibromm* 2
)mm2 3
,mm3 4
newmm5 8
{mm9 :
idmm; =
=mm> ?
libromm@ E
.mmE F
IdLibrommF M
}mmN O
,mmO P
librommQ V
)mmV W
;mmW X
}nn 	
[qq 	
HttpPutqq	 
(qq 
$strqq 
)qq 
]qq 
publicrr 
asyncrr 
Taskrr 
<rr 
IActionResultrr '
>rr' (
PutLibrorr) 1
(rr1 2
intrr2 5
idrr6 8
,rr8 9
LibroUptrr: B
librouptrrC K
)rrK L
{ss 	
varuu 
librouu 
=uu 
newuu 
Librouu !
{vv 
IdLibroww 
=ww 
librouptww "
.ww" #
IdLibroww# *
,ww* +
IdEditorialxx 
=xx 
librouptxx &
.xx& '
IdEditorialxx' 2
,xx2 3
IdGeneroyy 
=yy 
librouptyy #
.yy# $
IdGeneroyy$ ,
,yy, -
	Destitulozz 
=zz 
librouptzz $
.zz$ %
	Destitulozz% .
,zz. /
Estado{{ 
={{ 
libroupt{{ !
.{{! "
Estado{{" (
,{{( )
ISBN|| 
=|| 
libroupt|| 
.||  
ISBN||  $
,||$ %
Sinopsys}} 
=}} 
libroupt}} #
.}}# $
Sinopsys}}$ ,
,}}, -
	IdUsuario~~ 
=~~ 
libroupt~~ $
.~~$ %
	IdUsuario~~% .
} 
; 
if
ÅÅ 
(
ÅÅ 
id
ÅÅ 
!=
ÅÅ 
libro
ÅÅ 
.
ÅÅ 
IdLibro
ÅÅ #
)
ÅÅ# $
{
ÇÇ 
return
ÉÉ 

BadRequest
ÉÉ !
(
ÉÉ! "
new
ÉÉ" %
{
ÉÉ& '
Message
ÉÉ( /
=
ÉÉ0 1
$str
ÉÉ2 h
}
ÉÉi j
)
ÉÉj k
;
ÉÉk l
}
ÑÑ 
_context
ÜÜ 
.
ÜÜ 
Entry
ÜÜ 
(
ÜÜ 
libro
ÜÜ  
)
ÜÜ  !
.
ÜÜ! "
State
ÜÜ" '
=
ÜÜ( )
EntityState
ÜÜ* 5
.
ÜÜ5 6
Modified
ÜÜ6 >
;
ÜÜ> ?
try
àà 
{
ââ 
await
ää 
_context
ää 
.
ää 
SaveChangesAsync
ää /
(
ää/ 0
)
ää0 1
;
ää1 2
return
ãã 
Ok
ãã 
(
ãã 
new
ãã 
{
ãã 
Message
ãã  '
=
ãã( )
$str
ãã* H
}
ããI J
)
ããJ K
;
ããK L
}
çç 
catch
éé 
(
éé *
DbUpdateConcurrencyException
éé /
)
éé/ 0
{
èè 
if
êê 
(
êê 
!
êê 
_context
êê 
.
êê 
Libros
êê $
.
êê$ %
Any
êê% (
(
êê( )
e
êê) *
=>
êê+ -
e
êê. /
.
êê/ 0
IdLibro
êê0 7
==
êê8 :
id
êê; =
)
êê= >
)
êê> ?
{
ëë 
return
íí 
NotFound
íí "
(
íí" #
new
íí# &
{
íí' (
Message
íí) 0
=
íí1 2
$str
íí3 P
}
ííQ R
)
ííR S
;
ííS T
}
ìì 
else
îî 
{
ïï 
throw
ññ 
;
ññ 
}
óó 
}
òò 
return
öö 
	NoContent
öö 
(
öö 
)
öö 
;
öö 
}
õõ 	
[
ùù 	

HttpDelete
ùù	 
(
ùù 
$str
ùù 
)
ùù 
]
ùù 
public
ûû 
async
ûû 
Task
ûû 
<
ûû 
IActionResult
ûû '
>
ûû' (
DeleteLibro
ûû) 4
(
ûû4 5
int
ûû5 8
id
ûû9 ;
)
ûû; <
{
üü 	
var
†† 
libro
†† 
=
†† 
await
†† 
_context
†† &
.
††& '
Libros
††' -
.
††- .
	FindAsync
††. 7
(
††7 8
id
††8 :
)
††: ;
;
††; <
if
°° 
(
°° 
libro
°° 
==
°° 
null
°° 
)
°° 
{
¢¢ 
return
££ 
NotFound
££ 
(
££  
)
££  !
;
££! "
}
§§ 
_context
¶¶ 
.
¶¶ 
Libros
¶¶ 
.
¶¶ 
Remove
¶¶ "
(
¶¶" #
libro
¶¶# (
)
¶¶( )
;
¶¶) *
await
ßß 
_context
ßß 
.
ßß 
SaveChangesAsync
ßß +
(
ßß+ ,
)
ßß, -
;
ßß- .
return
©© 
	NoContent
©© 
(
©© 
)
©© 
;
©© 
}
™™ 	
}
´´ 
public
≠≠ 
class
≠≠ 
LibroConSubasta
≠≠ $
{
ÆÆ 	
public
∞∞ 
int
∞∞ 
IdEditorial
∞∞ "
{
∞∞# $
get
∞∞% (
;
∞∞( )
set
∞∞* -
;
∞∞- .
}
∞∞/ 0
public
±± 
int
±± 
IdGenero
±± 
{
±±  !
get
±±" %
;
±±% &
set
±±' *
;
±±* +
}
±±, -
public
≤≤ 
string
≤≤ 
	Destitulo
≤≤ #
{
≤≤$ %
get
≤≤& )
;
≤≤) *
set
≤≤+ .
;
≤≤. /
}
≤≤0 1
public
≥≥ 
string
≥≥ 
Estado
≥≥  
{
≥≥! "
get
≥≥# &
;
≥≥& '
set
≥≥( +
;
≥≥+ ,
}
≥≥- .
public
¥¥ 
string
¥¥ 
ISBN
¥¥ 
{
¥¥  
get
¥¥! $
;
¥¥$ %
set
¥¥& )
;
¥¥) *
}
¥¥+ ,
public
µµ 
string
µµ 
Sinopsys
µµ "
{
µµ# $
get
µµ% (
;
µµ( )
set
µµ* -
;
µµ- .
}
µµ/ 0
public
∂∂ 
int
∂∂ 
?
∂∂ 
	IdUsuario
∂∂ !
{
∂∂" #
get
∂∂$ '
;
∂∂' (
set
∂∂) ,
;
∂∂, -
}
∂∂. /
public
ππ 
DateTime
ππ 
	FecInicio
ππ %
{
ππ& '
get
ππ( +
;
ππ+ ,
set
ππ- 0
;
ππ0 1
}
ππ2 3
public
∫∫ 
DateTime
∫∫ 
FecFinal
∫∫ $
{
∫∫% &
get
∫∫' *
;
∫∫* +
set
∫∫, /
;
∫∫/ 0
}
∫∫1 2
public
ªª 
double
ªª 

PrecioBase
ªª $
{
ªª% &
get
ªª' *
;
ªª* +
set
ªª, /
;
ªª/ 0
}
ªª1 2
}
ºº 	
public
ææ 
class
ææ 
LibroUpt
ææ  
{
øø 	
public
¿¿ 
int
¿¿ 
IdLibro
¿¿ 
{
¿¿  
get
¿¿  #
;
¿¿# $
set
¿¿$ '
;
¿¿' (
}
¿¿( )
public
¡¡ 
int
¡¡ 
IdEditorial
¡¡ "
{
¡¡# $
get
¡¡% (
;
¡¡( )
set
¡¡* -
;
¡¡- .
}
¡¡/ 0
public
¬¬ 
int
¬¬ 
IdGenero
¬¬ 
{
¬¬  !
get
¬¬" %
;
¬¬% &
set
¬¬' *
;
¬¬* +
}
¬¬, -
public
√√ 
string
√√ 
	Destitulo
√√ #
{
√√$ %
get
√√& )
;
√√) *
set
√√+ .
;
√√. /
}
√√0 1
public
ƒƒ 
string
ƒƒ 
Estado
ƒƒ  
{
ƒƒ! "
get
ƒƒ# &
;
ƒƒ& '
set
ƒƒ( +
;
ƒƒ+ ,
}
ƒƒ- .
public
≈≈ 
string
≈≈ 
ISBN
≈≈ 
{
≈≈  
get
≈≈! $
;
≈≈$ %
set
≈≈& )
;
≈≈) *
}
≈≈+ ,
public
∆∆ 
string
∆∆ 
Sinopsys
∆∆ "
{
∆∆# $
get
∆∆% (
;
∆∆( )
set
∆∆* -
;
∆∆- .
}
∆∆/ 0
public
«« 
int
«« 
?
«« 
	IdUsuario
«« !
{
««" #
get
««$ '
;
««' (
set
««) ,
;
««, -
}
««. /
}
»» 	
}ÀÀ ≥⁄
jD:\Otros\UPN\CaliidadYPruebas\ProyectoGit\Back\AppGreenPageBack\GreenPageAPI\Controllers\AuthController.cs
	namespace 	
GreenPageAPI
 
. 
Controllers "
{		 
public

 

class

 
AuthController

 
:

  !
ControllerBase

" 0
{ 
private 
readonly 
GreenPageContext )
dataContext* 5
;5 6
public 
AuthController 
( 
GreenPageContext .
context/ 6
)6 7
{ 	
dataContext 
= 
context !
;! "
} 	
[ 	
HttpPost	 
( 
$str  
)  !
]! "
public 
async 
Task 
< 
IActionResult '
>' (
Recuperauser) 5
(5 6
[6 7
FromBody7 ?
]? @
	UserModelA J
	usermodelK T
)T U
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "

ModelState" ,
), -
;- .
} 
var 
user 
= 
await 
dataContext (
.( )
Usuarios) 1
.1 2
FirstOrDefaultAsync2 E
(E F
uF G
=>H J
uK L
.L M
LoginM R
==S U
	usermodelV _
._ `
User` d
)d e
;e f
if 
( 
user 
== 
null 
) 
{   
return!! 
NotFound!! 
(!!  
$str!!  8
)!!8 9
;!!9 :
}"" 
var$$ 
response$$ 
=$$ 
new$$ 
{%% 
message&& 
=&& 
$str&& .
,&&. /

userlogger'' 
='' 
new''  
{(( 
id)) 
=)) 
user)) 
.)) 
	IdUsuario)) '
,))' (
Pregunta** 
=** 
user** #
.**# $
Pregunta**$ ,
}.. 
}// 
;// 
return00 
Ok00 
(00 
response00 
)00 
;00  
}11 	
[44 	
HttpPost44	 
(44 
$str44 
)44 
]44 
public55 
async55 
Task55 
<55 
IActionResult55 '
>55' (
Login55) .
(55. /
[55/ 0
FromBody550 8
]558 9

LoginModel55: D
model55E J
)55J K
{66 	
if77 
(77 
!77 

ModelState77 
.77 
IsValid77 #
)77# $
return77% +

BadRequest77, 6
(776 7

ModelState777 A
)77A B
;77B C
try99 
{:: 
var;; 
user;; 
=;; 
await;;  
GetUserByLoginAsync;;! 4
(;;4 5
model;;5 :
.;;: ;
User;;; ?
);;? @
;;;@ A
if<< 
(<< 
user<< 
==<< 
null<<  
)<<  !
return<<" (
NotFound<<) 1
(<<1 2
$str<<2 J
)<<J K
;<<K L
if>> 
(>> 
!>> 
IsUserActive>> !
(>>! "
user>>" &
)>>& '
)>>' (
return>>) /
Unauthorized>>0 <
(>>< =
$str>>= P
)>>P Q
;>>Q R
if@@ 
(@@ 
!@@ 
IsPasswordValid@@ $
(@@$ %
model@@% *
.@@* +
Pass@@+ /
,@@/ 0
user@@1 5
.@@5 6
Pass@@6 :
)@@: ;
)@@; <
return@@= C
Unauthorized@@D P
(@@P Q
$str@@Q i
)@@i j
;@@j k
varBB 
responseBB 
=BB !
GenerateLoginResponseBB 4
(BB4 5
userBB5 9
)BB9 :
;BB: ;
returnCC 
OkCC 
(CC 
responseCC "
)CC" #
;CC# $
}DD 
catchEE 
(EE 
	ExceptionEE 
exEE 
)EE  
{FF 
returnGG 
HandleExceptionGG &
(GG& '
exGG' )
)GG) *
;GG* +
}HH 
}II 	
privateKK 
asyncKK 
TaskKK 
<KK 
UsuarioKK "
?KK" #
>KK# $
GetUserByLoginAsyncKK% 8
(KK8 9
stringKK9 ?
loginKK@ E
)KKE F
{LL 	
returnMM 
awaitMM 
dataContextMM $
.MM$ %
UsuariosMM% -
.MM- .
FirstOrDefaultAsyncMM. A
(MMA B
uMMB C
=>MMD F
uMMG H
.MMH I
LoginMMI N
==MMO Q
loginMMR W
)MMW X
;MMX Y
}NN 	
staticPP	 
boolPP 
IsUserActivePP !
(PP! "
UsuarioPP" )
userPP* .
)PP. /
{QQ 	
returnRR 
userRR 
.RR 
isactiveRR  
==RR! #
trueRR$ (
;RR( )
}SS 	
privateUU 
staticUU 
boolUU 
IsPasswordValidUU +
(UU+ ,
stringUU, 2
enteredPasswordUU3 B
,UUB C
stringUUD J
storedPasswordUUK Y
)UUY Z
{VV 	
returnWW 
BCryptWW 
.WW 
NetWW 
.WW 
BCryptWW $
.WW$ %
VerifyWW% +
(WW+ ,
enteredPasswordWW, ;
,WW; <
storedPasswordWW= K
)WWK L
;WWL M
}XX 	
privateZZ 
objectZZ !
GenerateLoginResponseZZ ,
(ZZ, -
UsuarioZZ- 4
userZZ5 9
)ZZ9 :
{[[ 	
return\\ 
new\\ 
{]] 
message^^ 
=^^ 
$str^^ )
,^^) *

userlogger__ 
=__ 
new__  
{`` 
idaa 
=aa 
useraa 
.aa 
	IdUsuarioaa '
,aa' (

nomUsuariobb 
=bb  
userbb! %
.bb% &

NomUsuariobb& 0
,bb0 1
idPerfilcc 
=cc 
usercc #
.cc# $
IdPerfilcc$ ,
,cc, -
perfilNombredd  
=dd! "
userdd# '
.dd' (
IdPerfildd( 0
==dd1 3
$numdd4 5
?dd6 7
$strdd8 N
:ddO P
$strddQ X
}ee 
}ff 
;ff 
}gg 	
privateii 
IActionResultii 
HandleExceptionii -
(ii- .
	Exceptionii. 7
exii8 :
)ii: ;
{jj 	
ifll 
(ll 
exll 
.ll 
InnerExceptionll !
!=ll" $
nullll% )
&&ll* ,
exll- /
.ll/ 0
InnerExceptionll0 >
.ll> ?
Messagell? F
.llF G
ContainsllG O
(llO P
$strllP \
)ll\ ]
)ll] ^
{mm 
returnnn 

StatusCodenn !
(nn! "
StatusCodesnn" -
.nn- .'
Status503ServiceUnavailablenn. I
,nnI J
$strnnK t
)nnt u
;nnu v
}oo 
returnqq 

StatusCodeqq 
(qq 
StatusCodesqq )
.qq) *(
Status500InternalServerErrorqq* F
,qqF G
$strqqH j
)qqj k
;qqk l
}rr 	
[vv 	
HttpPostvv	 
(vv 
$strvv 
)vv 
]vv 
publicww 
asyncww 
Taskww 
<ww 
IActionResultww '
>ww' (
Registerww) 1
(ww1 2
[ww2 3
FromBodyww3 ;
]ww; <
Usuarioww= D
usuariowwE L
)wwL M
{xx 	
if}} 
(}} 
string}} 
.}} 
IsNullOrWhiteSpace}} )
(}}) *
usuario}}* 1
.}}1 2

NomUsuario}}2 <
)}}< =
&&}}> @
string~~ 
.~~ 
IsNullOrWhiteSpace~~ )
(~~) *
usuario~~* 1
.~~1 2

ApeUsuario~~2 <
)~~< =
&&~~> @
string 
. 
IsNullOrWhiteSpace )
() *
usuario* 1
.1 2
dni2 5
)5 6
&&7 9
string
ÄÄ 
.
ÄÄ  
IsNullOrWhiteSpace
ÄÄ )
(
ÄÄ) *
usuario
ÄÄ* 1
.
ÄÄ1 2
Login
ÄÄ2 7
)
ÄÄ7 8
&&
ÄÄ9 ;
string
ÅÅ 
.
ÅÅ  
IsNullOrWhiteSpace
ÅÅ )
(
ÅÅ) *
usuario
ÅÅ* 1
.
ÅÅ1 2
Pass
ÅÅ2 6
)
ÅÅ6 7
&&
ÅÅ8 :
string
ÇÇ 
.
ÇÇ  
IsNullOrWhiteSpace
ÇÇ )
(
ÇÇ) *
usuario
ÇÇ* 1
.
ÇÇ1 2
Pregunta
ÇÇ2 :
)
ÇÇ: ;
&&
ÇÇ< >
string
ÉÉ 
.
ÉÉ  
IsNullOrWhiteSpace
ÉÉ )
(
ÉÉ) *
usuario
ÉÉ* 1
.
ÉÉ1 2
	Respuesta
ÉÉ2 ;
)
ÉÉ; <
)
ÉÉ< =
{
ÑÑ 
return
ÖÖ 

BadRequest
ÖÖ !
(
ÖÖ! "
$str
ÖÖ" A
)
ÖÖA B
;
ÖÖB C
}
ÜÜ 
if
ää 
(
ää 
string
ää 
.
ää  
IsNullOrWhiteSpace
ää )
(
ää) *
usuario
ää* 1
.
ää1 2

NomUsuario
ää2 <
)
ää< =
)
ää= >
{
ãã 
return
åå 

BadRequest
åå !
(
åå! "
$str
åå" O
)
ååO P
;
ååP Q
}
çç 
if
éé 
(
éé 
!
éé 
usuario
éé 
.
éé &
ValidarEspaciosIzquierda
éé 1
(
éé1 2
usuario
éé2 9
.
éé9 :

NomUsuario
éé: D
)
ééD E
)
ééE F
{
èè 
return
êê 

BadRequest
êê !
(
êê! "
$str
êê" `
)
êê` a
;
êêa b
}
ëë 
if
íí 
(
íí 
!
íí 
usuario
íí 
.
íí 
IsValidLength
íí &
(
íí& '
usuario
íí' .
.
íí. /

NomUsuario
íí/ 9
.
íí9 :
Trim
íí: >
(
íí> ?
)
íí? @
)
íí@ A
)
ííA B
{
ìì 
return
îî 

BadRequest
îî !
(
îî! "
$strîî" ì
)îîì î
;îîî ï
}
ïï 
if
ññ 
(
ññ 
!
ññ 
usuario
ññ 
.
ññ !
ContainsOnlyLetters
ññ ,
(
ññ, -
usuario
ññ- 4
.
ññ4 5

NomUsuario
ññ5 ?
)
ññ? @
)
ññ@ A
{
óó 
return
òò 

BadRequest
òò !
(
òò! "
$str
òò" k
)
òòk l
;
òòl m
}
ôô 
if
úú 
(
úú 
string
úú 
.
úú  
IsNullOrWhiteSpace
úú )
(
úú) *
usuario
úú* 1
.
úú1 2

ApeUsuario
úú2 <
)
úú< =
)
úú= >
{
ùù 
return
ûû 

BadRequest
ûû !
(
ûû! "
$str
ûû" Q
)
ûûQ R
;
ûûR S
}
üü 
if
†† 
(
†† 
!
†† 
usuario
†† 
.
†† &
ValidarEspaciosIzquierda
†† 1
(
††1 2
usuario
††2 9
.
††9 :

ApeUsuario
††: D
)
††D E
)
††E F
{
°° 
return
¢¢ 

BadRequest
¢¢ !
(
¢¢! "
$str
¢¢" b
)
¢¢b c
;
¢¢c d
}
££ 
if
§§ 
(
§§ 
!
§§ 
usuario
§§ 
.
§§ 
IsValidLength
§§ &
(
§§& '
usuario
§§' .
.
§§. /

ApeUsuario
§§/ 9
.
§§9 :
Trim
§§: >
(
§§> ?
)
§§? @
)
§§@ A
)
§§A B
{
•• 
return
¶¶ 

BadRequest
¶¶ !
(
¶¶! "
$str¶¶" ï
)¶¶ï ñ
;¶¶ñ ó
}
ßß 
if
®® 
(
®® 
!
®® 
usuario
®® 
.
®® !
ContainsOnlyLetters
®® ,
(
®®, -
usuario
®®- 4
.
®®4 5

ApeUsuario
®®5 ?
)
®®? @
)
®®@ A
{
©© 
return
™™ 

BadRequest
™™ !
(
™™! "
$str
™™" m
)
™™m n
;
™™n o
}
´´ 
var
ÆÆ 
existingUser
ÆÆ 
=
ÆÆ 
await
ÆÆ $
dataContext
ÆÆ% 0
.
ÆÆ0 1
Usuarios
ÆÆ1 9
.
ÆÆ9 :!
FirstOrDefaultAsync
ÆÆ: M
(
ÆÆM N
u
ÆÆN O
=>
ÆÆP R
u
ÆÆS T
.
ÆÆT U
Login
ÆÆU Z
==
ÆÆ[ ]
usuario
ÆÆ^ e
.
ÆÆe f
Login
ÆÆf k
)
ÆÆk l
;
ÆÆl m
if
ØØ 
(
ØØ 
existingUser
ØØ 
!=
ØØ 
null
ØØ  $
)
ØØ$ %
{
∞∞ 
return
±± 

BadRequest
±± !
(
±±! "
$str
±±" G
)
±±G H
;
±±H I
}
≤≤ 
if
≥≥ 
(
≥≥ 
string
≥≥ 
.
≥≥  
IsNullOrWhiteSpace
≥≥ )
(
≥≥) *
usuario
≥≥* 1
.
≥≥1 2
dni
≥≥2 5
)
≥≥5 6
)
≥≥6 7
{
¥¥ 
return
µµ 

BadRequest
µµ !
(
µµ! "
$str
µµ" L
)
µµL M
;
µµM N
}
∂∂ 
if
∑∑ 
(
∑∑ 
usuario
∑∑ 
.
∑∑ 
dni
∑∑ 
.
∑∑ 
Length
∑∑ "
!=
∑∑# %
$num
∑∑& '
)
∑∑' (
{
∏∏ 
return
ππ 

BadRequest
ππ !
(
ππ! "
$str
ππ" L
)
ππL M
;
ππM N
}
∫∫ 
if
ªª 
(
ªª 
!
ªª 
usuario
ªª 
.
ªª 
dni
ªª 
.
ªª 
All
ªª  
(
ªª  !
char
ªª! %
.
ªª% &
IsDigit
ªª& -
)
ªª- .
)
ªª. /
{
ºº 
return
ΩΩ 

BadRequest
ΩΩ !
(
ΩΩ! "
$str
ΩΩ" Y
)
ΩΩY Z
;
ΩΩZ [
}
ææ 
var
¡¡ 
existingdni
¡¡ 
=
¡¡ 
await
¡¡ #
dataContext
¡¡$ /
.
¡¡/ 0
Usuarios
¡¡0 8
.
¡¡8 9!
FirstOrDefaultAsync
¡¡9 L
(
¡¡L M
u
¡¡M N
=>
¡¡O Q
u
¡¡R S
.
¡¡S T
dni
¡¡T W
==
¡¡X Z
usuario
¡¡[ b
.
¡¡b c
dni
¡¡c f
)
¡¡f g
;
¡¡g h
if
¬¬ 
(
¬¬ 
existingdni
¬¬ 
!=
¬¬ 
null
¬¬ #
)
¬¬# $
{
√√ 
return
ƒƒ 

BadRequest
ƒƒ %
(
ƒƒ% &
$str
ƒƒ& I
)
ƒƒI J
;
ƒƒJ K
}
≈≈ 
if
…… 
(
…… 
string
…… 
.
……  
IsNullOrWhiteSpace
…… )
(
……) *
usuario
……* 1
.
……1 2
Login
……2 7
)
……7 8
)
……8 9
{
   
return
ÀÀ 

BadRequest
ÀÀ !
(
ÀÀ! "
$str
ÀÀ" N
)
ÀÀN O
;
ÀÀO P
}
ÃÃ 
if
ÕÕ 
(
ÕÕ 
!
ÕÕ 
usuario
ÕÕ 
.
ÕÕ &
ValidarEspaciosIzquierda
ÕÕ 1
(
ÕÕ1 2
usuario
ÕÕ2 9
.
ÕÕ9 :
Login
ÕÕ: ?
)
ÕÕ? @
)
ÕÕ@ A
{
ŒŒ 
return
œœ 

BadRequest
œœ !
(
œœ! "
$str
œœ" T
)
œœT U
;
œœU V
}
–– 
if
—— 
(
—— 
!
—— 
usuario
—— 
.
—— 
IsValidLength
—— &
(
——& '
usuario
——' .
.
——. /
Login
——/ 4
.
——4 5
Trim
——5 9
(
——9 :
)
——: ;
)
——; <
)
——< =
{
““ 
return
”” 

BadRequest
”” !
(
””! "
$str
””" ^
)
””^ _
;
””_ `
}
‘‘ 
if
’’ 
(
’’ 
!
’’ 
usuario
’’ 
.
’’ 
IsValidEmail
’’ %
(
’’% &
usuario
’’& -
.
’’- .
Login
’’. 3
)
’’3 4
)
’’4 5
{
÷÷ 
return
◊◊ 

BadRequest
◊◊ !
(
◊◊! "
$str
◊◊" _
)
◊◊_ `
;
◊◊` a
}
ÿÿ 
if
€€ 
(
€€ 
string
€€ 
.
€€  
IsNullOrWhiteSpace
€€ )
(
€€) *
usuario
€€* 1
.
€€1 2
Pass
€€2 6
)
€€6 7
)
€€7 8
{
‹‹ 
return
›› 

BadRequest
›› !
(
››! "
$str
››" M
)
››M N
;
››N O
}
ﬁﬁ 
if
ﬂﬂ 
(
ﬂﬂ 
!
ﬂﬂ 
usuario
ﬂﬂ 
.
ﬂﬂ 
IsValidPassword
ﬂﬂ (
(
ﬂﬂ( )
)
ﬂﬂ) *
)
ﬂﬂ* +
{
‡‡ 
return
·· 

BadRequest
·· !
(
··! "
$str
··" 
)·· Ä
;··Ä Å
}
‚‚ 
if
ÂÂ 
(
ÂÂ 
string
ÂÂ 
.
ÂÂ  
IsNullOrWhiteSpace
ÂÂ )
(
ÂÂ) *
usuario
ÂÂ* 1
.
ÂÂ1 2
Pregunta
ÂÂ2 :
)
ÂÂ: ;
)
ÂÂ; <
{
ÊÊ 
return
ÁÁ 

BadRequest
ÁÁ !
(
ÁÁ! "
$str
ÁÁ" Q
)
ÁÁQ R
;
ÁÁR S
}
ËË 
if
ÏÏ 
(
ÏÏ 
string
ÏÏ 
.
ÏÏ  
IsNullOrWhiteSpace
ÏÏ )
(
ÏÏ) *
usuario
ÏÏ* 1
.
ÏÏ1 2
	Respuesta
ÏÏ2 ;
)
ÏÏ; <
)
ÏÏ< =
{
ÌÌ 
return
ÓÓ 

BadRequest
ÓÓ !
(
ÓÓ! "
$str
ÓÓ" R
)
ÓÓR S
;
ÓÓS T
}
ÔÔ 
if
 
(
 
!
 
usuario
 
.
 &
ValidarEspaciosIzquierda
 1
(
1 2
usuario
2 9
.
9 :
	Respuesta
: C
)
C D
)
D E
{
ÒÒ 
return
ÚÚ 

BadRequest
ÚÚ !
(
ÚÚ! "
$str
ÚÚ" X
)
ÚÚX Y
;
ÚÚY Z
}
ÛÛ 
if
ÙÙ 
(
ÙÙ 
!
ÙÙ 
usuario
ÙÙ 
.
ÙÙ $
IsValidLengthRespuesta
ÙÙ /
(
ÙÙ/ 0
)
ÙÙ0 1
)
ÙÙ1 2
{
ıı 
return
ˆˆ 

BadRequest
ˆˆ !
(
ˆˆ! "
$strˆˆ" â
)ˆˆâ ä
;ˆˆä ã
}
˜˜ 
if
˙˙ 
(
˙˙ 
!
˙˙ 
usuario
˙˙ 
.
˙˙ !
ContainsOnlyLetters
˙˙ ,
(
˙˙, -
usuario
˙˙- 4
.
˙˙4 5
	Respuesta
˙˙5 >
)
˙˙> ?
)
˙˙? @
{
˚˚ 
return
¸¸ 

BadRequest
¸¸ !
(
¸¸! "
$str
¸¸" c
)
¸¸c d
;
¸¸d e
}
˝˝ 
if
ÄÄ 
(
ÄÄ 
!
ÄÄ 

ModelState
ÄÄ 
.
ÄÄ 
IsValid
ÄÄ "
)
ÄÄ" #
{
ÅÅ 
return
ÇÇ 

BadRequest
ÇÇ  
(
ÇÇ  !

ModelState
ÇÇ! +
)
ÇÇ+ ,
;
ÇÇ, -
}
ÉÉ 
usuario
ÜÜ 
.
ÜÜ 
Pass
ÜÜ 
=
ÜÜ 
BCrypt
ÜÜ !
.
ÜÜ! "
Net
ÜÜ" %
.
ÜÜ% &
BCrypt
ÜÜ& ,
.
ÜÜ, -
HashPassword
ÜÜ- 9
(
ÜÜ9 :
usuario
ÜÜ: A
.
ÜÜA B
Pass
ÜÜB F
)
ÜÜF G
;
ÜÜG H
if
ââ 
(
ââ 
usuario
ââ 
.
ââ 
IdPerfil
ââ  
==
ââ! #
null
ââ$ (
||
ââ) +
usuario
ââ, 3
.
ââ3 4
IdPerfil
ââ4 <
<=
ââ= ?
$num
ââ@ A
)
ââA B
{
ää 
usuario
ãã 
.
ãã 
IdPerfil
ãã  
=
ãã! "
$num
ãã# $
;
ãã$ %
}
åå 
usuario
éé 
.
éé 
isactive
éé 
=
éé 
true
éé #
;
éé# $
usuario
ëë 
.
ëë 
FecCreacion
ëë 
=
ëë  !
DateTime
ëë" *
.
ëë* +
Now
ëë+ .
;
ëë. /
try
ìì 
{
îî 
dataContext
ññ 
.
ññ 
Usuarios
ññ $
.
ññ$ %
Add
ññ% (
(
ññ( )
usuario
ññ) 0
)
ññ0 1
;
ññ1 2
await
ôô 
dataContext
ôô !
.
ôô! "
SaveChangesAsync
ôô" 2
(
ôô2 3
)
ôô3 4
;
ôô4 5
return
õõ 
Ok
õõ 
(
õõ 
new
õõ 
{
õõ 
message
õõ  '
=
õõ( )
$str
õõ* <
}
õõ= >
)
õõ> ?
;
õõ? @
}
úú 
catch
ùù 
(
ùù 
	Exception
ùù 
ex
ùù 
)
ùù  
{
ûû 
var
üü 
innerException
üü "
=
üü# $
ex
üü% '
.
üü' (
InnerException
üü( 6
!=
üü7 9
null
üü: >
?
üü? @
ex
üüA C
.
üüC D
InnerException
üüD R
.
üüR S
Message
üüS Z
:
üü[ \
ex
üü] _
.
üü_ `
Message
üü` g
;
üüg h
return
†† 

BadRequest
†† !
(
††! "
innerException
††" 0
)
††0 1
;
††1 2
}
°° 
}
¢¢ 	
[
•• 
HttpPost
•• 
(
•• 
$str
•• %
)
••% &
]
••& '
public
¶¶ 
async
¶¶ 
Task
¶¶ 
<
¶¶ 
IActionResult
¶¶ +
>
¶¶+ ,
ActualizaPass
¶¶- :
(
¶¶: ;
[
¶¶; <
FromBody
¶¶< D
]
¶¶D E
	PassModel
¶¶F O
	passModel
¶¶P Y
)
¶¶Y Z
{
ßß 
if
®® 
(
®® 
!
®® 

ModelState
®® 
.
®®  
IsValid
®®  '
)
®®' (
{
©© 
return
™™ 

BadRequest
™™ %
(
™™% &

ModelState
™™& 0
)
™™0 1
;
™™1 2
}
´´ 
if
ÆÆ 
(
ÆÆ 
string
ÆÆ 
.
ÆÆ  
IsNullOrWhiteSpace
ÆÆ -
(
ÆÆ- .
	passModel
ÆÆ. 7
.
ÆÆ7 8
	Respuesta
ÆÆ8 A
)
ÆÆA B
)
ÆÆB C
{
ØØ 
return
∞∞ 

BadRequest
∞∞ %
(
∞∞% &
$str
∞∞& J
)
∞∞J K
;
∞∞K L
}
±± 
if
≥≥ 
(
≥≥ 
string
≥≥ 
.
≥≥  
IsNullOrWhiteSpace
≥≥ -
(
≥≥- .
	passModel
≥≥. 7
.
≥≥7 8
Pass
≥≥8 <
)
≥≥< =
)
≥≥= >
{
¥¥ 
return
µµ 

BadRequest
µµ %
(
µµ% &
$str
µµ& K
)
µµK L
;
µµL M
}
∂∂ 
var
ππ 
user
ππ 
=
ππ 
await
ππ  
dataContext
ππ! ,
.
ππ, -
Usuarios
ππ- 5
.
ππ5 6!
FirstOrDefaultAsync
ππ6 I
(
ππI J
u
ππJ K
=>
ππL N
u
∫∫ 
.
∫∫ 
Login
∫∫ 
==
∫∫ 
	passModel
∫∫ $
.
∫∫$ %
User
∫∫% )
&&
∫∫* ,
u
ªª 
.
ªª 
Pregunta
ªª 
==
ªª 
	passModel
ªª '
.
ªª' (
Pregunta
ªª( 0
&&
ªª1 3
u
ºº 
.
ºº 
	Respuesta
ºº 
==
ºº 
	passModel
ºº (
.
ºº( )
	Respuesta
ºº) 2
)
ºº2 3
;
ºº3 4
if
ææ 
(
ææ 
user
ææ 
==
ææ 
null
ææ  
)
ææ  !
{
øø 
return
¿¿ 
NotFound
¿¿ #
(
¿¿# $
$str
¿¿$ Y
)
¿¿Y Z
;
¿¿Z [
}
¡¡ 
var
ƒƒ 
passwordPattern
ƒƒ #
=
ƒƒ$ %
$str
ƒƒ& K
;
ƒƒK L
if
≈≈ 
(
≈≈ 
!
≈≈ 
Regex
≈≈ 
.
≈≈ 
IsMatch
≈≈ "
(
≈≈" #
	passModel
≈≈# ,
.
≈≈, -
Pass
≈≈- 1
,
≈≈1 2
passwordPattern
≈≈3 B
)
≈≈B C
)
≈≈C D
{
∆∆ 
return
«« 

BadRequest
«« %
(
««% &
$str««& Ç
)««Ç É
;««É Ñ
}
»» 
user
ÕÕ 
.
ÕÕ 
Pass
ÕÕ 
=
ÕÕ 
BCrypt
ÕÕ "
.
ÕÕ" #
Net
ÕÕ# &
.
ÕÕ& '
BCrypt
ÕÕ' -
.
ÕÕ- .
HashPassword
ÕÕ. :
(
ÕÕ: ;
	passModel
ÕÕ; D
.
ÕÕD E
Pass
ÕÕE I
)
ÕÕI J
;
ÕÕJ K
await
–– 
dataContext
–– !
.
––! "
SaveChangesAsync
––" 2
(
––2 3
)
––3 4
;
––4 5
return
““ 
Ok
““ 
(
““ 
new
““ 
{
““ 
message
““  '
=
““( )
$str
““* P
}
““Q R
)
““R S
;
““S T
}
”” 
}◊◊ 
public
ÿÿ 
class
ÿÿ 

LoginModel
ÿÿ 
{
ŸŸ 	
[
⁄⁄ 
Required
⁄⁄ 
]
⁄⁄ 
public
€€ 
string
€€ 
User
€€ 
{
€€  
get
€€! $
;
€€$ %
set
€€& )
;
€€) *
}
€€+ ,
[
›› 
Required
›› 
]
›› 
public
ﬁﬁ 
string
ﬁﬁ 
Pass
ﬁﬁ 
{
ﬁﬁ  
get
ﬁﬁ! $
;
ﬁﬁ$ %
set
ﬁﬁ& )
;
ﬁﬁ) *
}
ﬁﬁ+ ,
}
ﬂﬂ 	
public
‚‚ 
class
‚‚ 
	UserModel
‚‚ 
{
„„ 	
[
‰‰ 
Required
‰‰ 
]
‰‰ 
public
ÂÂ 
string
ÂÂ 
User
ÂÂ 
{
ÂÂ  
get
ÂÂ! $
;
ÂÂ$ %
set
ÂÂ& )
;
ÂÂ) *
}
ÂÂ+ ,
}
ÊÊ 	
public
ËË 
class
ËË 
	PassModel
ËË 
{
ÈÈ 	
[
ÍÍ 
Required
ÍÍ 
]
ÍÍ 
public
ÎÎ 
string
ÎÎ 
User
ÎÎ 
{
ÎÎ  
get
ÎÎ! $
;
ÎÎ$ %
set
ÎÎ& )
;
ÎÎ) *
}
ÎÎ+ ,
[
ÌÌ 
Required
ÌÌ 
]
ÌÌ 
public
ÓÓ 
string
ÓÓ 
Pregunta
ÓÓ "
{
ÓÓ# $
get
ÓÓ% (
;
ÓÓ( )
set
ÓÓ* -
;
ÓÓ- .
}
ÓÓ/ 0
[
 
Required
 
]
 
public
ÒÒ 
string
ÒÒ 
	Respuesta
ÒÒ #
{
ÒÒ$ %
get
ÒÒ& )
;
ÒÒ) *
set
ÒÒ+ .
;
ÒÒ. /
}
ÒÒ0 1
[
ÛÛ 
Required
ÛÛ 
]
ÛÛ 
public
ÙÙ 
string
ÙÙ 
Pass
ÙÙ 
{
ÙÙ  
get
ÙÙ  #
;
ÙÙ# $
set
ÙÙ$ '
;
ÙÙ' (
}
ÙÙ( )
}
ıı 	
}˜˜ 